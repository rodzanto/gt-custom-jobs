{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) {\n    s += arguments[i].length;\n  }\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) {\n    for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) {\n      r[k] = a[j];\n    }\n  }\n\n  return r;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nexports.__esModule = true;\n\nvar react_1 = __importDefault(require(\"react\"));\n\nvar Mark_1 = __importDefault(require(\"./Mark\"));\n\nvar utils_1 = require(\"./utils\");\n\nvar Split = function Split(props) {\n  if (props.mark) return react_1[\"default\"].createElement(Mark_1[\"default\"], __assign({}, props));\n  return react_1[\"default\"].createElement(\"span\", {\n    \"data-start\": props.start,\n    \"data-end\": props.end,\n    onClick: function onClick() {\n      return props.onClick({\n        start: props.start,\n        end: props.end\n      });\n    }\n  }, props.content);\n};\n\nvar TextAnnotator = function TextAnnotator(props) {\n  var getSpan = function getSpan(span) {\n    // TODO: Better typings here.\n    if (props.getSpan) return props.getSpan(span);\n    return {\n      start: span.start,\n      end: span.end\n    };\n  };\n\n  var handleMouseUp = function handleMouseUp() {\n    var _a;\n\n    if (!props.onChange) return;\n    var selection = window.getSelection();\n    if (utils_1.selectionIsEmpty(selection)) return;\n    var start = parseInt(selection.anchorNode.parentElement.getAttribute('data-start'), 10) + selection.anchorOffset;\n    var end = parseInt(selection.focusNode.parentElement.getAttribute('data-start'), 10) + selection.focusOffset;\n\n    if (utils_1.selectionIsBackwards(selection)) {\n      ;\n      _a = [end, start], start = _a[0], end = _a[1];\n    }\n\n    props.onChange(__spreadArrays(props.value, [getSpan({\n      start: start,\n      end: end,\n      text: content.slice(start, end)\n    })]));\n    window.getSelection().empty();\n  };\n\n  var handleSplitClick = function handleSplitClick(_a) {\n    var start = _a.start,\n        end = _a.end; // Find and remove the matching split.\n\n    var splitIndex = props.value.findIndex(function (s) {\n      return s.start === start && s.end === end;\n    });\n\n    if (splitIndex >= 0) {\n      props.onChange(__spreadArrays(props.value.slice(0, splitIndex), props.value.slice(splitIndex + 1)));\n    }\n  };\n\n  var content = props.content,\n      value = props.value,\n      style = props.style;\n  var splits = utils_1.splitWithOffsets(content, value);\n  return react_1[\"default\"].createElement(\"div\", {\n    style: style,\n    onMouseUp: handleMouseUp\n  }, splits.map(function (split) {\n    return react_1[\"default\"].createElement(Split, __assign({\n      key: split.start + \"-\" + split.end\n    }, split, {\n      onClick: handleSplitClick\n    }));\n  }));\n};\n\nexports[\"default\"] = TextAnnotator;","map":null,"metadata":{},"sourceType":"script"}